
<!DOCTYPE html><html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.33.1" theme-name="Stellar" theme-version="1.33.1">
  
  
  <meta name="generator" content="Hexo 6.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  <title>SSDæºç è§£æ - Caiusçš„æ—¥å¸¸åšå®¢</title>

  
    <meta name="description" content="è®ºæ–‡åœ°å€: SSD: Single Shot MultiBox Detector éå®˜æ–¹ä»£ç : pytorch ä»‹ç»SSDï¼Œå…¨ç§°Single Shot MultiBox Detectorï¼Œæ˜¯ä¸€ç§One-Stageçš„æ–¹æ³•ï¼Œå®ƒç”±Wei Liuåœ¨ECCV 2016ä¸Šæå‡ºï¼ŒSSDå…·æœ‰å¦‚ä¸‹ä¸»è¦ç‰¹ç‚¹ï¼š  ä»YOLOä¸­ç»§æ‰¿äº†å°†detectionè½¬åŒ–ä¸ºregressionçš„æ€è·¯ï¼ŒåŒæ—¶ä¸€æ¬¡å³å¯å®Œæˆç½‘ç»œè®­ç»ƒ åŸºäºFa">
<meta property="og:type" content="article">
<meta property="og:title" content="SSDæºç è§£æ">
<meta property="og:url" content="https://caiusy.github.io/2019/08/24/ssd/">
<meta property="og:site_name" content="Caiusçš„æ—¥å¸¸åšå®¢">
<meta property="og:description" content="è®ºæ–‡åœ°å€: SSD: Single Shot MultiBox Detector éå®˜æ–¹ä»£ç : pytorch ä»‹ç»SSDï¼Œå…¨ç§°Single Shot MultiBox Detectorï¼Œæ˜¯ä¸€ç§One-Stageçš„æ–¹æ³•ï¼Œå®ƒç”±Wei Liuåœ¨ECCV 2016ä¸Šæå‡ºï¼ŒSSDå…·æœ‰å¦‚ä¸‹ä¸»è¦ç‰¹ç‚¹ï¼š  ä»YOLOä¸­ç»§æ‰¿äº†å°†detectionè½¬åŒ–ä¸ºregressionçš„æ€è·¯ï¼ŒåŒæ—¶ä¸€æ¬¡å³å¯å®Œæˆç½‘ç»œè®­ç»ƒ åŸºäºFa">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://caiusy.github.io/images/avatar.jpg">
<meta property="article:published_time" content="2019-08-23T16:00:00.000Z">
<meta property="article:modified_time" content="2026-02-20T07:15:58.507Z">
<meta property="article:author" content="Caius Lu">
<meta property="article:tag" content="PyTorch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://caiusy.github.io/images/avatar.jpg">
  
  
  
  <meta name="keywords" content="PyTorch">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.33.1">


  

  

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Caius Lu","sameAs":[],"image":"https://caiusy.github.io/images/avatar.jpg"},"dateCreated":"2019-08-24T00:00:00+08:00","dateModified":"2026-02-20T15:15:58+08:00","datePublished":"2019-08-24T00:00:00+08:00","description":"","headline":"SSDæºç è§£æ","mainEntityOfPage":{"@type":"WebPage","@id":"https://caiusy.github.io/2019/08/24/ssd/"},"publisher":{"@type":"Organization","name":"Caius Lu","sameAs":[],"image":"https://caiusy.github.io/images/avatar.jpg","logo":{"@type":"ImageObject","url":"https://caiusy.github.io/images/avatar.jpg"}},"url":"https://caiusy.github.io/2019/08/24/ssd/","keywords":"PyTorch","image":[]}</script>
  <link rel="stylesheet" href="/css/custom.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body content" id="start" layout="post" type="tech" ><aside class="l_left"><div class="sidebg"></div><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/images/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main">Caiusçš„æ—¥å¸¸åšå®¢</div><div class="sub normal cap">è®¡ç®—æœºè§†è§‰</div><div class="sub hover cap" style="opacity:0"> å¤§æ¨¡å‹åˆå­¦è€…</div></a></div></header>

<div class="nav-area">

<nav class="menu dis-select"><a class="nav-item active" title="åšå®¢" href="/" style="color:#6366F1"><img src="https://api.iconify.design/solar:documents-bold-duotone.svg?color=%236366F1"/></a><a class="nav-item" title="å½’æ¡£" href="/archives/" style="color:#10B981"><img src="https://api.iconify.design/solar:archive-bold-duotone.svg?color=%2310B981"/></a><a class="nav-item" title="åˆ†ç±»" href="/categories/" style="color:#F59E0B"><img src="https://api.iconify.design/solar:folder-with-files-bold-duotone.svg?color=%23F59E0B"/></a><a class="nav-item" title="æ ‡ç­¾" href="/tags/" style="color:#EC4899"><img src="https://api.iconify.design/solar:tag-bold-duotone.svg?color=%23EC4899"/></a></nav>
</div>
<div class="widgets">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Search"></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div>



<widget class="widget-wrapper slide-up recent post-list"><div class="widget-header dis-select"><span class="name">Recent Update</span></div><div class="widget-body fs14"><a class="item title" href="/2026/02/20/20250220-dynamic-programming-complete-guide/"><span class="title">åŠ¨æ€è§„åˆ’å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š</span></a><a class="item title" href="/2019/08/28/20190828-shutil%E6%A8%A1%E5%9D%97/"><span class="title">shutilæ¨¡å—</span></a><a class="item title" href="/2019/09/06/20190906-%E5%8F%98%E6%80%81%E8%B7%B3%E5%8F%B0%E9%98%B6/"><span class="title">å˜æ€è·³å°é˜¶</span></a><a class="item title" href="/2019/10/13/20191013-park%E5%81%9C%E8%BD%A6%E5%9C%BA%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/"><span class="title">parkåœè½¦åœºé¡¹ç›®å®æˆ˜</span></a><a class="item title" href="/2026/02/03/bert-comprehensive-guide/"><span class="title">BERT å®Œæ•´è§£æï¼šä»è®ºæ–‡åˆ° KV Cache</span></a><a class="item title" href="/2019/08/28/20190828-opencv%E6%A8%A1%E5%9D%97/"><span class="title">opencvæ¨¡å—</span></a><a class="item title" href="/2019/09/02/20190902-%E7%94%A8%E4%B8%A4%E4%B8%AA%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"><span class="title">ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</span></a><a class="item title" href="/2019/09/12/20190912-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/"><span class="title">åè½¬é“¾è¡¨</span></a><a class="item title" href="/2019/09/14/20190914-%E6%A0%91%E7%9A%84%E5%AD%90%E7%BB%93%E6%9E%84/"><span class="title">æ ‘çš„å­ç»“æ„</span></a><a class="item title" href="/2019/10/31/20191031-attention-mechanism-xmind/"><span class="title">attention_mechanism_xmind</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/caiusy" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/08a41b181ce68.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner slide-up top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a></div>
<div class="flex-row" id="post-meta"><span class="text created">Posted on: <time datetime="2019-08-23T16:00:00.000Z">2019-08-24</time></span><span class="sep updated"></span><span class="text updated">Updated on: <time datetime="2026-02-20T07:15:58.507Z">2026-02-20</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>SSDæºç è§£æ</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content slide-up"><p>è®ºæ–‡åœ°å€: <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1512.02325.pdf">SSD: Single Shot MultiBox Detector </a><br>éå®˜æ–¹ä»£ç : <a target="_blank" rel="noopener" href="https://github.com/amdegroot/ssd.pytorch">pytorch</a></p>
<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>SSDï¼Œå…¨ç§°Single Shot MultiBox Detectorï¼Œæ˜¯ä¸€ç§One-Stageçš„æ–¹æ³•ï¼Œå®ƒç”±Wei Liuåœ¨ECCV 2016ä¸Šæå‡ºï¼ŒSSDå…·æœ‰å¦‚ä¸‹ä¸»è¦ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä»YOLOä¸­ç»§æ‰¿äº†å°†detectionè½¬åŒ–ä¸ºregressionçš„æ€è·¯ï¼ŒåŒæ—¶ä¸€æ¬¡å³å¯å®Œæˆç½‘ç»œè®­ç»ƒ</li>
<li>åŸºäºFaster RCNNä¸­çš„anchorï¼Œæå‡ºäº†ç›¸ä¼¼çš„prior box</li>
<li>åŠ å…¥åŸºäºç‰¹å¾é‡‘å­—å¡”ï¼ˆPyramidal Feature Hierarchyï¼‰çš„æ£€æµ‹æ–¹å¼ï¼Œç›¸å½“äºåŠä¸ªFPNæ€è·¯</li>
</ul>
<h2 id="SSDçš„-ç½‘ç»œç»“æ„"><a href="#SSDçš„-ç½‘ç»œç»“æ„" class="headerlink" title="SSDçš„ ç½‘ç»œç»“æ„"></a>SSDçš„ ç½‘ç»œç»“æ„</h2><p><img src="/2019/08/24/ssd/images/20190824_ssd_ssdarchitecture.png"></p>
<p>ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒSSDçš„åŸºç¡€ç½‘ç»œç»“æ„ç”±åŸºç¡€ç½‘ç»œVGG16ç»„æˆï¼Œåœ¨VGG16åŸºç¡€ç½‘ç»œä¹‹åæ¥äº†ä¸€ä¸ª3x3çš„å·ç§¯å’Œä¸€ä¸ª1x1çš„å·ç§¯åšç‰¹å¾èåˆï¼Œç„¶åå¢åŠ äº†ä¸€ä¸ªExtra Feature Layers å±‚ï¼Œè¿™ä¸ªå±‚ç”±å…«ä¸ªå·ç§¯å±‚æ„æˆã€‚SSDåœ¨å‰é¢çš„åŸºç¡€ç½‘ç»œå»conv_4_3ä¹‹åçš„reluå±‚è¾“å‡ºï¼Œä»¥åŠå€’æ•°ç¬¬äºŒå±‚çš„conv_7_1çš„reluå†åŠ ä¸ŠExtra Feature Layerså±‚çš„ç¬¬1,3,5,7å±‚ å…±æœ‰6ä¸ª featuremapå±‚ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯¹boxè¿›è¡Œé¢„æµ‹ã€‚ä½†æ„Ÿè§‰è¦æå‡æ•ˆæœçš„è¯å¯ä»¥å¯¹åŸºç¡€ç½‘ç»œè¿›è¡Œæ›´æ”¹ï¼Œå¢åŠ ç‰¹å¾èåˆç­‰ç­‰ã€‚</p>
<h3 id="ç©ºæ´å·ç§¯-Dilation-Conv"><a href="#ç©ºæ´å·ç§¯-Dilation-Conv" class="headerlink" title="ç©ºæ´å·ç§¯(Dilation Conv)"></a>ç©ºæ´å·ç§¯(Dilation Conv)</h3><p>ssdç½‘ç»œé‡Œè¿˜ä½¿ç”¨äº†ç©ºæ´å·ç§¯(Dilation Conv),é‡‡ç”¨VGG16åšåŸºç¡€æ¨¡å‹ï¼Œé¦–å…ˆVGG16æ˜¯åœ¨ILSVRC CLS-LOCæ•°æ®é›†é¢„è®­ç»ƒã€‚ç„¶åå€Ÿé‰´äº†DeepLab-LargeFOVï¼Œåˆ†åˆ«å°†VGG16çš„å…¨è¿æ¥å±‚fc6å’Œfc7è½¬æ¢æˆ 3Ã—3å·ç§¯å±‚ conv6å’Œ 1Ã—1 å·ç§¯å±‚conv7ï¼ŒåŒæ—¶å°†æ± åŒ–å±‚ pool5 ç”±åŸæ¥çš„ stride=2 çš„ 2Ã—2 å˜æˆ stride=1 çš„(çŒœæƒ³æ˜¯ä¸æƒ³reduceç‰¹å¾å›¾å¤§å°)ï¼Œä¸ºäº†é…åˆè¿™ç§å˜åŒ–ï¼Œé‡‡ç”¨äº†ä¸€ç§ Atrous Algorithmï¼Œå…¶å®å°±æ˜¯conv6é‡‡ç”¨æ‰©å±•å·ç§¯æˆ–å¸¦å­”å·ç§¯ï¼ˆDilation Convï¼‰ï¼Œå…¶åœ¨ä¸å¢åŠ å‚æ•°ä¸æ¨¡å‹å¤æ‚åº¦çš„æ¡ä»¶ä¸‹æŒ‡æ•°çº§æ‰©å¤§å·ç§¯çš„è§†é‡ï¼Œå…¶ä½¿ç”¨æ‰©å¼ ç‡(dilation rate)å‚æ•°ï¼Œæ¥è¡¨ç¤ºæ‰©å¼ çš„å¤§å°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ(a)æ˜¯æ™®é€šçš„ 3Ã—3 å·ç§¯ï¼Œå…¶è§†é‡å°±æ˜¯ 3Ã—3 ï¼Œ(b)æ˜¯æ‰©å¼ ç‡ä¸º 1ï¼Œæ­¤æ—¶è§†é‡å˜æˆ 7Ã—7 ï¼Œ(c)æ‰©å¼ ç‡ä¸º3æ—¶ï¼Œè§†é‡æ‰©å¤§ä¸º 15Ã—15 ï¼Œä½†æ˜¯è§†é‡çš„ç‰¹å¾æ›´ç¨€ç–äº†ã€‚Conv6é‡‡ç”¨ 3Ã—3 å¤§å°ä½†dilation rate=6çš„æ‰©å±•å·ç§¯ã€‚</p>
<h2 id="Prior-Box"><a href="#Prior-Box" class="headerlink" title="Prior Box"></a>Prior Box</h2><p>SSDä¸­æœ‰ç€ç±»ä¼¼anchoræœºåˆ¶çš„Prior Boxæœºåˆ¶ï¼Œç”¨äºæ¥ç”Ÿæˆå…ˆéªŒæ¡†ï¼Œåé¢å°†è¿™äº›å…ˆéªŒæ¡†ä¸çœŸå®çš„gtè¿›è¡ŒåŒ¹é…ï¼Œç„¶åä¸é¢„æµ‹çš„è¿›è¡Œå›å½’ã€‚ä»è€Œå¾—åˆ°ç‰©ä½“çœŸå®çš„ ä½ç½®ã€‚<br>SSDçš„prior Box æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ç”Ÿæˆï¼š</p>
<ul>
<li><p>ä»¥feature mapä¸Šæ¯ä¸ªç‚¹çš„ä¸­ç‚¹ä¸ºä¸­å¿ƒï¼ˆoffset=0.5ï¼‰ï¼Œç”Ÿæˆä¸€äº›åˆ—åŒå¿ƒçš„prior boxï¼ˆç„¶åä¸­å¿ƒç‚¹çš„åæ ‡ä¼šä¹˜ä»¥stepï¼Œç›¸å½“äºä»feature mapä½ç½®æ˜ å°„å›åŸå›¾ä½ç½®ï¼‰</p>
</li>
<li><p>æ­£æ–¹å½¢prior boxæœ€å°è¾¹é•¿ä¸ºâ€™â€™â€™pash $min_size$â€™â€™â€™ï¼Œæœ€å¤§è¾¹é•¿ä¸ºï¼š\sqrt{min_size*max_size}<br>E=mc^2</p>
</li>
<li><p>æ ¹æ®ç›¸åº”çš„aspect ratioï¼Œä¼šç”Ÿæˆä¸åŒä¸ªæ•°çš„é•¿æ–¹å½¢ ï¼Œé•¿å®½ä¸ºï¼š$ \sqrt{aspect_ratio}<em>min_size$ å’Œ $1/ \sqrt{aspect_ratio}</em> min_size$ $f(x)=ax+b$</p>
</li>
<li><p>æœ€ç»ˆç½‘ç»œç”Ÿæˆå›ºå®šæ•°é‡çš„Prior Box</p>
</li>
<li><p>æ¯ä¸ªfeature map å¯¹åº”prior boxçš„min_size å’Œmax_size ç”±ä»¥ä¸‹çš„å…¬å¼å†³å®šï¼Œå…¬å¼ä¸­çš„mæ˜¯ä½¿ç”¨feature mapçš„æ•°é‡(m=6)ç¬¬ä¸€å±‚feature mapå¯¹åº”çš„min_size=S1ï¼Œmax_size=S2ï¼›ç¬¬äºŒå±‚min_size=S2ï¼Œmax_size=S3ï¼›å…¶ä»–ç±»æ¨ã€‚åœ¨åŸæ–‡ä¸­ï¼ŒSmin=0.2ï¼ŒSmax=0.9<img src="/2019/08/24/ssd/images/20190824_ssd_priorbox.png"></p>
</li>
</ul>
<p>| min_size | max_size | def.boxes num<br>â€”|â€”|â€”|â€”<br>conv4_3 | 30 | 60 | 4<br>fc7 | 60 | 111 | 6<br>conv6_2 | 111 | 162 | 6<br>fc7 | 162 | 213 | 6<br>conv4_3 | 213 | 264 | 4<br>fc7 | 264 | 315 | 4  </p>
<h2 id="è®­ç»ƒç­–ç•¥"><a href="#è®­ç»ƒç­–ç•¥" class="headerlink" title="è®­ç»ƒç­–ç•¥"></a>è®­ç»ƒç­–ç•¥</h2><h3 id="æ­£è´Ÿæ ·æœ¬"><a href="#æ­£è´Ÿæ ·æœ¬" class="headerlink" title="æ­£è´Ÿæ ·æœ¬"></a>æ­£è´Ÿæ ·æœ¬</h3><p>ç»™å®šè¾“å…¥å›¾åƒä»¥åŠæ¯ä¸ªç‰©ä½“çš„Ground Truth,é¦–å…ˆæ‰¾åˆ°æ¯ä¸ªGround True boxå¯¹åº”çš„default boxä¸­IOUæœ€å¤§çš„æœ€ä¸ºæ­£æ ·æœ¬ã€‚ç„¶å,åœ¨å‰©ä¸‹çš„default boxä¸­å¯»æ‰¾ä¸Ground Truth çš„IOUå¤§äº0.5çš„default boxä½œä¸ºæ­£æ ·æœ¬ã€‚ä¸€ä¸ªGround Truthå¯èƒ½å¯¹åº”å¤šä¸ªæ­£æ ·æœ¬default box.å…¶ä»–çš„default boxä½œä¸ºè´Ÿæ ·æœ¬ã€‚,ä¸ºäº†ä¿è¯æ ·æœ¬å°½é‡å¹³è¡¡,SSDé‡‡ç”¨äº†hard nagative mining,å³å¯¹è´Ÿæ ·æœ¬è¿›è¡ŒæŠ½æ ·,æŠ½æ ·æ—¶æŒ‰ç…§ç½®ä¿¡åº¦è¯¯å·®(é¢„æµ‹èƒŒæ™¯çš„ç½®ä¿¡åº¦è¶Šå°,è¯¯å·®è¶Šå¤§)è¿›è¡Œå¥–åºæ’åˆ—,é€‰å–è¯¯å·®è¾ƒå¤§çš„top-kä½œä¸ºè®­ç»ƒçš„è´Ÿæ ·æœ¬,ä¿è¯æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹æ¥è¿‘1:3ã€‚</p>
<h3 id="ç›®æ ‡å‡½æ•°"><a href="#ç›®æ ‡å‡½æ•°" class="headerlink" title="ç›®æ ‡å‡½æ•°"></a>ç›®æ ‡å‡½æ•°</h3><p>ç›®æ ‡å‡½æ•°ä¸ºè®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¼˜åŒ–æ ‡å‡†,ç›®æ ‡å‡½æ•°ä¹Ÿç§°æŸå¤±å‡½æ•°,ä¸»è¦åŒ…æ‹¬ä½ç½®è¯¯å·®(localization loss,loc) ä¸ç½®ä¿¡åº¦è¯¯å·®(confidence loss,conf,åˆ†ç±»æŸå¤±)çš„åŠ æƒå’Œ,å®šä¹‰ä¸ºï¼š</p>
<h1 id="ä»£ç è§£æ"><a href="#ä»£ç è§£æ" class="headerlink" title="ä»£ç è§£æ"></a>ä»£ç è§£æ</h1><h2 id="åŸºç¡€æ¨¡å‹å®šä¹‰"><a href="#åŸºç¡€æ¨¡å‹å®šä¹‰" class="headerlink" title="åŸºç¡€æ¨¡å‹å®šä¹‰"></a>åŸºç¡€æ¨¡å‹å®šä¹‰</h2><pre><code>1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  
12  
13  
14  
15  
16  
17  
18  
19  
20  
21  
22  
23  
24  
25  
26  
</code></pre>
<p>| </p>
<pre><code># vgg([64, 64, 'M', 128, 128, 'M', 256, 256, 256, 'C', 512, 512, 512, 'M',  
#             512, 512, 512], 3)  
# This function is derived from torchvision VGG make_layers()  
# https://github.com/pytorch/vision/blob/master/torchvision/models/vgg.py  
def vgg(cfg, i, batch_norm=False):  
    layers = []  
    in_channels = i  
    for v in cfg:  
        if v == 'M':  
            layers += [nn.MaxPool2d(kernel_size=2, stride=2)]  
        elif v == 'C':  
            layers += [nn.MaxPool2d(kernel_size=2, stride=2, ceil_mode=True)]  
        else:  
            conv2d = nn.Conv2d(in_channels, v, kernel_size=3, padding=1)  
            if batch_norm:  
                layers += [conv2d, nn.BatchNorm2d(v), nn.ReLU(inplace=True)]  
            else:  
                layers += [conv2d, nn.ReLU(inplace=True)]  
            in_channels = v  
    pool5 = nn.MaxPool2d(kernel_size=3, stride=1, padding=1)  
    conv6 = nn.Conv2d(512, 1024, kernel_size=3, padding=6, dilation=6)  
    conv7 = nn.Conv2d(1024, 1024, kernel_size=1)  
    layers += [pool5, conv6,  
               nn.ReLU(inplace=True), conv7, nn.ReLU(inplace=True)]  
    return layers  
  
</code></pre>
<p>â€”|â€”  </p>
<pre><code>1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  
12  
13  
14  
15  
16  
17  
18  
19  
20  
21  
22  
23  
24  
25  
26  
27  
28  
29  
30  
31  
32  
</code></pre>
<p>| </p>
<pre><code>base = {  
    '300': [64, 64, 'M', 128, 128, 'M', 256, 256, 256, 'C', 512, 512, 512, 'M',  
            512, 512, 512],  
    '512': [],  
}  
extras = {  
    '300': [256, 'S', 512, 128, 'S', 256, 128, 256, 128, 256],  
    '512': [],  
}  
mbox = {  
    '300': [4, 6, 6, 6, 4, 4],  # number of boxes per feature map location  
    '512': [],  
}  
  
def add_extras(cfg, i, batch_norm=False):  
    # Extra layers added to VGG for feature scaling  
    layers =[]  
    in_channel = i  
    flag = False  
    for k,v in enumerate(cfg):  
        if in_channel !="S":  
            if v == "S":  
                layers += [nn.Conv2d(in_channel,cfg[k+1],  
                                     kernel_size=(1,3)[flag], stride=2,padding=1)]   # flag æ¥æ§åˆ¶å·ç§¯æ ¸æ˜¯1 è¿˜æ˜¯3  
            else:  
                layers += [nn.Conv2d(in_channel, v, kernel_size=(1,3)[flag])]  
  
            flag = not flag  
  
        in_channel = v  
    return layers  
  
</code></pre>
<p>â€”|â€”  </p>
<h2 id="æ¨¡å‹Headéƒ¨åˆ†çš„ç”Ÿæˆ"><a href="#æ¨¡å‹Headéƒ¨åˆ†çš„ç”Ÿæˆ" class="headerlink" title="æ¨¡å‹Headéƒ¨åˆ†çš„ç”Ÿæˆ"></a>æ¨¡å‹Headéƒ¨åˆ†çš„ç”Ÿæˆ</h2><pre><code>1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  
12  
13  
14  
15  
16  
17  
18  
</code></pre>
<p>| </p>
<pre><code># cfg  [4, 6, 6, 6, 4, 4],  # number of boxes per feature map location  
def multibox(vgg, extra_layers, cfg, num_classes):  
    loc_layers = []  
    conf_layers = []  
    vgg_source = [21, -2]  
    for k, v in enumerate(vgg_source):  
        loc_layers += [nn.Conv2d(vgg[v].out_channels,  
                                 cfg[k] * 4, kernel_size=3, padding=1)]  
        conf_layers += [nn.Conv2d(vgg[v].out_channels,  
                        cfg[k] * num_classes, kernel_size=3, padding=1)]  
    # å¯¹extra_layersä¸­çš„ï¼ˆConv2d-2_1ã€Conv2d-4_1ã€Conv2d-6_1ã€Conv2d-8_1ï¼‰å±‚é€šè¿‡å·ç§¯æå–ç‰¹å¾  
    for k, v in enumerate(extra_layers[1::2], 2):  
        loc_layers += [nn.Conv2d(v.out_channels, cfg[k]  
                                 * 4, kernel_size=3, padding=1)]  
        conf_layers += [nn.Conv2d(v.out_channels, cfg[k]  
                                  * num_classes, kernel_size=3, padding=1)]  
    return vgg, extra_layers, (loc_layers, conf_layers)  
  
</code></pre>
<p>â€”|â€”  </p>
<h2 id="æ¨¡å‹å…ˆéªŒæ¡†çš„ç”Ÿæˆ"><a href="#æ¨¡å‹å…ˆéªŒæ¡†çš„ç”Ÿæˆ" class="headerlink" title="æ¨¡å‹å…ˆéªŒæ¡†çš„ç”Ÿæˆ"></a>æ¨¡å‹å…ˆéªŒæ¡†çš„ç”Ÿæˆ</h2><pre><code>1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  
12  
13  
14  
15  
16  
17  
18  
19  
20  
21  
22  
23  
24  
25  
26  
27  
28  
29  
30  
31  
32  
33  
34  
35  
36  
37  
38  
39  
40  
41  
42  
43  
44  
45  
46  
47  
48  
49  
50  
51  
52  
53  
54  
</code></pre>
<p>| </p>
<pre><code>class PriorBox(object):  
    """Compute priorbox coordinates in center-offset form for each source  
    feature map.  
    """  
    def __init__(self, cfg):  
        super(PriorBox, self).__init__()  
        self.image_size = cfg['min_dim']  
        # number of priors for feature map location (either 4 or 6)  
        self.num_priors = len(cfg['aspect_ratios'])  
        self.variance = cfg['variance'] or [0.1]  
        self.feature_maps = cfg['feature_maps']  
        self.min_sizes = cfg['min_sizes']  
        self.max_sizes = cfg['max_sizes']  
        self.steps = cfg['steps']  
        self.aspect_ratios = cfg['aspect_ratios']  
        self.clip = cfg['clip']  
        self.version = cfg['name']  
        for v in self.variance:  
            if v &lt;= 0:  
                raise ValueError('Variances must be greater than 0')  
  
    def forward(self):  
        mean = []  
        #   'steps': [8, 16, 32, 64, 100, 300],  
        # 'feature_maps': [38, 19, 10, 5, 3, 1],  
        #  'min_sizes': [21, 45, 99, 153, 207, 261],  
        # 'max_sizes': [45, 99, 153, 207, 261, 315],  
        for k, f in enumerate(self.feature_maps):  
            for i, j in product(range(f), repeat=2):  
                f_k = self.image_size / self.steps[k]  
                # unit center x,y  
                cx = (j + 0.5) / f_k  
                cy = (i + 0.5) / f_k  
  
                # aspect_ratio: 1  
                # rel size: min_size  
                s_k = self.min_sizes[k]/self.image_size  
                mean += [cx, cy, s_k, s_k]  
  
                # aspect_ratio: 1  
                # rel size: sqrt(s_k * s_(k+1))  
                s_k_prime = sqrt(s_k * (self.max_sizes[k]/self.image_size))  
                mean += [cx, cy, s_k_prime, s_k_prime]  
  
                # rest of aspect ratios  
                for ar in self.aspect_ratios[k]:  
                    mean += [cx, cy, s_k*sqrt(ar), s_k/sqrt(ar)]  
                    mean += [cx, cy, s_k/sqrt(ar), s_k*sqrt(ar)]  
        # back to torch land  
        output = torch.Tensor(mean).view(-1, 4)  
        if self.clip:  
            output.clamp_(max=1, min=0)  
        return output  
  
</code></pre>
<p>â€”|â€”  </p>
<h2 id="MultiBox-æŸå¤±å‡½æ•°"><a href="#MultiBox-æŸå¤±å‡½æ•°" class="headerlink" title="MultiBox æŸå¤±å‡½æ•°"></a>MultiBox æŸå¤±å‡½æ•°</h2><pre><code>1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  
12  
13  
14  
15  
16  
17  
18  
19  
20  
21  
22  
23  
24  
25  
26  
27  
28  
29  
30  
31  
32  
33  
34  
35  
36  
37  
38  
39  
40  
41  
42  
43  
44  
45  
46  
47  
48  
49  
50  
51  
52  
53  
54  
55  
56  
57  
58  
59  
60  
61  
62  
63  
64  
65  
66  
67  
68  
69  
70  
71  
72  
73  
74  
75  
76  
77  
78  
79  
80  
81  
82  
83  
84  
85  
86  
87  
88  
89  
90  
91  
92  
93  
94  
95  
96  
97  
98  
99  
100  
101  
102  
103  
104  
105  
106  
107  
108  
109  
110  
111  
112  
113  
114  
115  
116  
117  
118  
119  
120  
121  
122  
123  
124  
125  
126  
127  
128  
129  
130  
131  
132  
133  
134  
135  
136  
137  
138  
139  
140  
141  
142  
143  
144  
145  
146  
147  
148  
149  
150  
151  
152  
153  
154  
155  
</code></pre>
<p>| </p>
<pre><code>class MultiBoxLoss(nn.Module):  
    """SSD Weighted Loss Function  
    Compute Targets:  
        1) Produce Confidence Target Indices by matching  ground truth boxes  
           with (default) 'priorboxes' that have jaccard index &gt; threshold parameter  
           (default threshold: 0.5).  
        2) Produce localization target by 'encoding' variance into offsets of ground  
           truth boxes and their matched  'priorboxes'.  
        3) Hard negative mining to filter the excessive number of negative examples  
           that comes with using a large number of default bounding boxes.  
           (default negative:positive ratio 3:1)  
    Objective Loss:  
        L(x,c,l,g) = (Lconf(x, c) + Î±Lloc(x,l,g)) / N  
        Where, Lconf is the CrossEntropy Loss and Lloc is the SmoothL1 Loss  
        weighted by Î± which is set to 1 by cross val.  
        Args:  
            c: class confidences,  
            l: predicted boxes,  
            g: ground truth boxes  
            N: number of matched default boxes  
        See: https://arxiv.org/pdf/1512.02325.pdf for more details.  
  
  
        # è®¡ç®—ç›®æ ‡:  
        # è¾“å‡ºé‚£äº›ä¸çœŸå®æ¡†çš„iouå¤§äºä¸€å®šé˜ˆå€¼çš„æ¡†çš„ä¸‹æ ‡.  
        # æ ¹æ®ä¸çœŸå®æ¡†çš„åç§»é‡è¾“å‡ºlocalizationç›®æ ‡  
        # ç”¨éš¾æ ·ä¾‹æŒ–æ˜ç®—æ³•å»é™¤å¤§é‡è´Ÿæ ·æœ¬(é»˜è®¤æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹ä¸º1:3)  
        # ç›®æ ‡æŸå¤±:  
        # L(x,c,l,g) = (Lconf(x,c) + Î±Lloc(x,l,g)) / N  
        # å‚æ•°:  
        # c: ç±»åˆ«ç½®ä¿¡åº¦(class confidences)  
        # l: é¢„æµ‹çš„æ¡†(predicted boxes)  
        # g: çœŸå®æ¡†(ground truth boxes)  
        # N: åŒ¹é…åˆ°çš„æ¡†çš„æ•°é‡(number of matched default boxes)  
    """  
#  MultiBoxLoss(cfg['num_classes'], 0.5, True, 0, True, 3, 0.5, False, args.cuda)  
    def __init__(self, num_classes, overlap_thresh, prior_for_matching,  
                 bkg_label, neg_mining, neg_pos, neg_overlap, encode_target,  
                 use_gpu=True):  
        super(MultiBoxLoss, self).__init__()  
        self.use_gpu = use_gpu  
        self.num_classes = num_classes  # åˆ—è¡¨æ•°  21   
        self.threshold = overlap_thresh # äº¤å¹¶æ¯”é˜ˆå€¼, 0.5  
        self.background_label = bkg_label # èƒŒæ™¯æ ‡ç­¾, 0  
        self.encode_target = encode_target  # True æ²¡åµç”¨  
        self.use_prior_for_matching = prior_for_matching  # True, æ²¡åµç”¨  
        self.do_neg_mining = neg_mining  # è´Ÿæ ·æœ¬å’Œæ­£æ ·æœ¬çš„æ¯”ä¾‹, 3:1  
        self.negpos_ratio = neg_pos # 0.5 åˆ¤å®šè´Ÿæ ·æœ¬çš„é˜ˆå€¼.  
        self.neg_overlap = neg_overlap  # False æ²¡åµç”¨  
        self.variance = cfg['variance']  
  
    def forward(self, predictions, targets):  
        """Multibox Loss  
        Args:  
            predictions (tuple): A tuple containing loc preds, conf preds,  
            and prior boxes from SSD net.  
                conf shape: torch.size(batch_size,num_priors,num_classes)  
                loc shape: torch.size(batch_size,num_priors,4)  
                priors shape: torch.size(num_priors,4)  
  
            targets (tensor): Ground truth boxes and labels for a batch,  
                shape: [batch_size,num_objs,5] (last idx is the label).  
        """  
        loc_data, conf_data, priors = predictions  
        # loc_data: [batch_size, 8732, 4]  
        # conf_data: [batch_size, 8732, 21]  
        # priors: [8732, 4]  default box å¯¹äºä»»æ„çš„å›¾ç‰‡, éƒ½æ˜¯ç›¸åŒçš„, å› æ­¤æ— éœ€å¸¦æœ‰ batch ç»´åº¦  
        num = loc_data.size(0) # num = batch_size  
        priors = priors[:loc_data.size(1), :] # loc_data.size(1) = 8732, å› æ­¤ priors ç»´æŒä¸å˜  
        num_priors = (priors.size(0)) # num_priors = 8732  
        num_classes = self.num_classes # num_classes = 21 (é»˜è®¤ä¸ºvocæ•°æ®é›†)  
  
        # match priors (default boxes) and ground truth boxes  
        # å°†priors(default boxes)å’Œground truth boxesåŒ¹é…  
        loc_t = torch.Tensor(num, num_priors, 4) # shape:[batch_size, 8732, 4]  
        conf_t = torch.LongTensor(num, num_priors)  # shape:[batch_size, 8732]  
        for idx in range(num):  
            # targetsæ˜¯åˆ—è¡¨, åˆ—è¡¨çš„é•¿åº¦ä¸ºbatch_size, åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ ä¸ºä¸€ä¸ª tensor,  
            # å…¶ shape ä¸º [num_objs, 5], å…¶ä¸­ num_objs ä¸ºå½“å‰å›¾ç‰‡ä¸­ç‰©ä½“çš„æ•°é‡, ç¬¬äºŒç»´å‰4ä¸ªå…ƒç´ ä¸ºè¾¹æ¡†åæ ‡, æœ€åä¸€ä¸ªå…ƒç´ ä¸ºç±»åˆ«ç¼–å·(1~20)  
            truths = targets[idx][:, :-1].data # [num_objs, 4]  
            labels = targets[idx][:, -1].data  # [num_objs] ä½¿ç”¨çš„æ˜¯ -1, è€Œä¸æ˜¯ -1:, å› æ­¤, è¿”å›çš„ç»´åº¦å˜å°‘äº†  
            defaults = priors.data # [8732, 4]  
            # from ..box_utils import match  
            # å…³é”®å‡½æ•°, å®ç°å€™é€‰æ¡†ä¸çœŸå®æ¡†ä¹‹é—´çš„åŒ¹é…, æ³¨æ„æ˜¯å€™é€‰æ¡†è€Œä¸æ˜¯é¢„æµ‹ç»“æœæ¡†! è¿™ä¸ªå‡½æ•°å®ç°è¾ƒä¸ºå¤æ‚, ä¼šåœ¨åé¢ç€é‡è®²è§£  
            match(self.threshold, truths, defaults, self.variance, labels,  
                  loc_t, conf_t,  )  
        if self.use_gpu:  
            loc_t = loc_t.cuda()  
            conf_t = conf_t.cuda()  
        # wrap targets  
        # ç”¨Variableå°è£…loc_t, æ–°ç‰ˆæœ¬çš„ PyTorch æ— éœ€è¿™ä¹ˆåš, åªéœ€è¦å°† requires_grad å±æ€§è®¾ç½®ä¸º True å°±è¡Œäº†  
        loc_t = Variable(loc_t, requires_grad=False)  
        conf_t = Variable(conf_t, requires_grad=False)  
  
        pos = conf_t &gt; 0 # ç­›é€‰å‡º &gt;0 çš„boxä¸‹æ ‡(å¤§éƒ¨åˆ†éƒ½æ˜¯=0çš„)  
        num_pos = pos.sum(dim=1, keepdim=True) # æ±‚å’Œ, å–å¾—æ»¡è¶³æ¡ä»¶çš„boxçš„æ•°é‡, [batch_size, num_gt_threshold]  
  
        # Localization Loss (Smooth L1)  
        # Shape: [batch,num_priors,4]  
        # ä½ç½®(localization)æŸå¤±å‡½æ•°, ä½¿ç”¨ Smooth L1 å‡½æ•°æ±‚æŸå¤±  
        # loc_data:[batch, num_priors, 4]  
        # pos: [batch, num_priors]  
        # pos_idx: [batch, num_priors, 4], å¤åˆ¶ä¸‹æ ‡æˆåæ ‡æ ¼å¼, ä»¥ä¾¿è·å–åæ ‡å€¼  
        pos_idx = pos.unsqueeze(pos.dim()).expand_as(loc_data)  
        loc_p = loc_data[pos_idx].view(-1, 4) # è·å–é¢„æµ‹ç»“æœå€¼  
        loc_t = loc_t[pos_idx].view(-1, 4)    # è·å–gtå€¼  
        loss_l = F.smooth_l1_loss(loc_p, loc_t, size_average=False) # è®¡ç®—æŸå¤±  
  
        # Compute max conf across batch for hard negative mining  
        # è®¡ç®—æœ€å¤§çš„ç½®ä¿¡åº¦, ä»¥è¿›è¡Œéš¾è´Ÿæ ·æœ¬æŒ–æ˜  
        # conf_data: [batch, num_priors, num_classes]  
        # batch_conf: [batch, num_priors, num_classes]  
        batch_conf = conf_data.view(-1, self.num_classes)  
  
        # conf_t: [batch, num_priors]  
        # loss_c: [batch*num_priors, 1], è®¡ç®—æ¯ä¸ªpriorboxé¢„æµ‹åçš„æŸå¤±  
        loss_c = log_sum_exp(batch_conf) - batch_conf.gather(1, conf_t.view(-1, 1))  
          
        # éš¾è´Ÿæ ·æœ¬æŒ–æ˜, æŒ‰ç…§lossè¿›è¡Œæ’åº, å–lossæœ€å¤§çš„è´Ÿæ ·æœ¬å‚ä¸æ›´æ–°  
        # Hard Negative Mining  
        loss_c[pos] = 0  # filter out pos boxes for now # å°†æ‰€æœ‰çš„posä¸‹æ ‡çš„boxçš„lossç½®ä¸º0(posæŒ‡ç¤ºçš„æ˜¯æ­£æ ·æœ¬çš„ä¸‹æ ‡)  
        # å°† loss_c çš„shape ä» [batch*num_priors, 1] è½¬æ¢æˆ [batch, num_priors]  
        loss_c = loss_c.view(num, -1)  # reshape  
        # è¿›è¡Œé™åºæ’åº, å¹¶è·å–åˆ°æ’åºçš„ä¸‹æ ‡  
        _, loss_idx = loss_c.sort(1, descending=True)  
        # å°†ä¸‹æ ‡è¿›è¡Œå‡åºæ’åº, å¹¶è·å–åˆ°ä¸‹æ ‡çš„ä¸‹æ ‡  
        _, idx_rank = loss_idx.sort(1)  
        # num_pos: [batch, 1], ç»Ÿè®¡æ¯ä¸ªæ ·æœ¬ä¸­çš„objä¸ªæ•°  
        num_pos = pos.long().sum(1, keepdim=True)  
        # æ ¹æ®objçš„ä¸ªæ•°, ç¡®å®šè´Ÿæ ·æœ¬çš„ä¸ªæ•°(æ­£æ ·æœ¬çš„3å€)  
        num_neg = torch.clamp(self.negpos_ratio*num_pos, max=pos.size(1)-1)  
        # è·å–åˆ°è´Ÿæ ·æœ¬çš„ä¸‹æ ‡  
        neg = idx_rank &lt; num_neg.expand_as(idx_rank)  
          
        # è®¡ç®—åŒ…æ‹¬æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„ç½®ä¿¡åº¦æŸå¤±  
        # pos: [batch, num_priors]  
        # pos_idx: [batch, num_priors, num_classes]  
        pos_idx = pos.unsqueeze(2).expand_as(conf_data)  
  
        # neg: [batch, num_priors]  
        # neg_idx: [batch, num_priors, num_classes]  
        neg_idx = neg.unsqueeze(2).expand_as(conf_data)  
        # æŒ‰ç…§pos_idxå’Œneg_idxæŒ‡ç¤ºçš„ä¸‹æ ‡ç­›é€‰å‚ä¸è®¡ç®—æŸå¤±çš„é¢„æµ‹æ•°æ®  
        conf_p = conf_data[(pos_idx+neg_idx).gt(0)].view(-1, self.num_classes)  
        # æŒ‰ç…§pos_idxå’Œneg_idxç­›é€‰ç›®æ ‡æ•°æ®  
        targets_weighted = conf_t[(pos+neg).gt(0)]  
        # è®¡ç®—äºŒè€…çš„äº¤å‰ç†µ  
        loss_c = F.cross_entropy(conf_p, targets_weighted, size_average=False)  
  
        # Sum of losses: L(x,c,l,g) = (Lconf(x, c) + Î±Lloc(x,l,g)) / N  
        # å°†æŸå¤±å‡½æ•°å½’ä¸€åŒ–åè¿”å›  
        N = num_pos.data.sum()  
        loss_l /= N  
        loss_c /= N  
        return loss_l, loss_c  
  
</code></pre>
<p>â€”|â€”  </p>
<h2 id="matchå‡½æ•°çš„è§£æ"><a href="#matchå‡½æ•°çš„è§£æ" class="headerlink" title="matchå‡½æ•°çš„è§£æ"></a>matchå‡½æ•°çš„è§£æ</h2><pre><code>1  
2  
3  
4  
5  
6  
7  
8  
9  
10  
11  
12  
13  
14  
15  
16  
17  
18  
19  
20  
21  
22  
23  
24  
25  
26  
27  
28  
29  
30  
31  
32  
33  
34  
35  
36  
37  
38  
39  
40  
41  
42  
43  
44  
45  
46  
47  
48  
49  
50  
51  
52  
53  
54  
55  
56  
57  
58  
59  
60  
61  
62  
63  
64  
65  
66  
</code></pre>
<p>| </p>
<pre><code>def match(threshold, truths, priors, variances, labels, loc_t, conf_t, idx):  
    # threshold: (float) ç¡®å®šæ˜¯å¦åŒ¹é…çš„äº¤å¹¶æ¯”é˜ˆå€¼  
    # truths: (tensor: [num_obj, 4]) å­˜å‚¨çœŸå® box çš„è¾¹æ¡†åæ ‡  
    # priors: (tensor: [num_priors, 4], å³[8732, 4]), å­˜å‚¨æ¨èæ¡†çš„åæ ‡, æ³¨æ„, æ­¤æ—¶çš„æ¡†æ˜¯ default box, è€Œä¸æ˜¯ SSD ç½‘ç»œé¢„æµ‹å‡ºæ¥çš„æ¡†çš„åæ ‡, é¢„æµ‹çš„ç»“æœå­˜å‚¨åœ¨ loc_dataä¸­, å…¶ shape ä¸º[num_obj, 8732, 4].  
    # variances: cfg['variance'], [0.1, 0.2], ç”¨äºå°†åæ ‡è½¬æ¢æˆæ–¹ä¾¿è®­ç»ƒçš„å½¢å¼(å‚è€ƒRCNNç³»åˆ—å¯¹è¾¹æ¡†åæ ‡çš„å¤„ç†)  
    # labels: (tensor: [num_obj]), ä»£è¡¨äº†æ¯ä¸ªçœŸå® box å¯¹åº”çš„ç±»åˆ«çš„ç¼–å·  
    # loc_t: (tensor: [batches, 8732, 4]),  
    # conf_t: (tensor: [batches, 8732]),  
    # idx: batches ä¸­å›¾ç‰‡çš„åºå·, æ ‡è¯†å½“å‰æ­£åœ¨å¤„ç†çš„ image åœ¨ batches ä¸­çš„åºå·  
  
    # jaccard index  
    overlaps = jaccard(    # [A, B], è¿”å›ä»»æ„ä¸¤ä¸ªboxä¹‹é—´çš„äº¤å¹¶æ¯”, overlaps[i][j] ä»£è¡¨box_aä¸­çš„ç¬¬iä¸ªboxä¸box_bä¸­çš„ç¬¬jä¸ªboxä¹‹é—´çš„äº¤å¹¶æ¯”.  
        truths,  
        point_form(priors)  
    )  
  
    # äºŒéƒ¨å›¾åŒ¹é…(Bipartite Matching)  
    # [num_objs,1], å¾—åˆ°å¯¹äºæ¯ä¸ª gt box æ¥è¯´çš„åŒ¹é…åº¦æœ€é«˜çš„ prior box, å‰è€…å­˜å‚¨äº¤å¹¶æ¯”, åè€…å­˜å‚¨prior boxåœ¨num_priorsä¸­çš„ä½ç½®  
    best_prior_overlap, best_prior_idx = overlaps.max(1, keepdim=True)  # keepdim=True, å› æ­¤shapeä¸º[num_objs,1]  
    # [1,num_priors] best ground truth for each prior  
    # [1, num_priors], å³[1,8732], åŒç†, å¾—åˆ°å¯¹äºæ¯ä¸ª prior box æ¥è¯´çš„åŒ¹é…åº¦æœ€é«˜çš„ gt box  
    best_truth_overlap, best_truth_idx = overlaps.max(0, keepdim=True)  
    best_truth_idx.squeeze_(0) # ä¸Šé¢ç‰¹æ„ä¿ç•™äº†ç»´åº¦(keepdim=True), è¿™é‡Œåˆéƒ½æŠŠç»´åº¦ squeeze/reduce äº†, å®é™…ä¸Šåªéœ€ç”¨é»˜è®¤çš„ keepdim=False å°±å¯ä»¥è‡ªåŠ¨ squeeze/reduce ç»´åº¦.  
    best_truth_overlap.squeeze_(0)  
    best_prior_idx.squeeze_(1)  
    best_prior_overlap.squeeze_(1)  
  
  
  
    best_truth_overlap.index_fill_(0, best_prior_idx, 2)  # ensure best prior  
    # ç»´åº¦å‹ç¼©åå˜ä¸º[num_priors], best_prior_idx ç»´åº¦ä¸º[num_objs],  
    # è¯¥è¯­å¥ä¼šå°†ä¸gt boxåŒ¹é…åº¦æœ€å¥½çš„prior box çš„äº¤å¹¶æ¯”ç½®ä¸º 2, ç¡®ä¿å…¶æœ€å¤§, ä»¥å…é˜²æ­¢æŸäº› gtbox æ²¡æœ‰åŒ¹é…çš„ priorbox.  
  
    # å‡æƒ³ä¸€ç§æç«¯æƒ…å†µ, æ‰€æœ‰çš„priorboxä¸æŸä¸ªgtbox(æ ‡è®°ä¸ºG)çš„äº¤å¹¶æ¯”ä¸º1, è€Œå…¶ä»–gtboxåˆ†åˆ«æœ‰ä¸€ä¸ªäº¤å¹¶æ¯”  
    # æœ€é«˜çš„priorbox, ä½†æ˜¯è‚¯å®šå°äº1(å› ä¸ºå…¶ä»–çš„gtboxä¸Gçš„äº¤å¹¶æ¯”è‚¯å®šå°äº1), è¿™æ ·ä¸€æ¥, å°±ä¼šä½¿å¾—æ‰€æœ‰  
    # çš„priorboxéƒ½ä¸GåŒ¹é…, ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µ, æˆ‘ä»¬å°†é‚£äº›å¯¹gtboxæ¥è¯´, å…·æœ‰æœ€é«˜äº¤å¹¶æ¯”çš„priorbox,  
    # å¼ºåˆ¶è¿›è¡Œäº’ç›¸åŒ¹é…, å³ä»¤best_truth_idx[best_prior_idx[j]] = j, è¯¦ç»†è§ä¸‹é¢çš„forå¾ªç¯  
  
  
    # TODO refactor: index  best_prior_idx with long tensor  
    # ensure every gt matches with its prior of max overlap  
    # æ³¨æ„!!: å› ä¸º gt box çš„æ•°é‡è¦è¿œè¿œå°‘äº prior box çš„æ•°é‡, å› æ­¤, åŒä¸€ä¸ª gt box ä¼šä¸å¤šä¸ª prior box åŒ¹é….  
    for j in range(best_prior_idx.size(0)):  
        best_truth_idx[best_prior_idx[j]] = j  
        # best_prior_idx[j] ä»£è¡¨ä¸box_açš„ç¬¬jä¸ªboxäº¤å¹¶æ¯”æœ€é«˜çš„ prior box çš„ä¸‹æ ‡, å°†ä¸è¯¥ gtbox  
        # åŒ¹é…åº¦æœ€å¥½çš„ prior box çš„ä¸‹æ ‡æ”¹ä¸ºj, ç”±æ­¤,å®Œæˆäº†è¯¥ gtbox ä¸ç¬¬jä¸ª prior box çš„åŒ¹é….  
        # è¿™é‡Œçš„å¾ªç¯åªä¼šè¿›è¡Œnum_objæ¬¡, å‰©ä½™çš„åŒ¹é…ä¸º best_truth_idx ä¸­åŸæœ¬çš„å€¼.  
        # è¿™é‡Œå¤„ç†çš„æƒ…å†µæ˜¯, priorboxä¸­ç¬¬iä¸ªboxä¸gtboxä¸­ç¬¬kä¸ªboxçš„äº¤å¹¶æ¯”æœ€é«˜,  
        # å³ best_truth_idx[i]= k  
        # ä½†æ˜¯å¯¹äºbest_prior_idx[k]æ¥è¯´, å®ƒå´ä¸priorboxçš„ç¬¬lä¸ªboxæœ‰ç€æœ€é«˜çš„äº¤å¹¶æ¯”,  
        # å³best_prior_idx[k]=l  
        # è€Œå¯¹äºgtboxçš„å¦ä¸€ä¸ªè¾¹æ¡†gtbox[j]æ¥è¯´, å®ƒä¸priorbox[i]çš„äº¤å¹¶æ¯”æœ€å¤§,  
        # å³ä½†æ˜¯å¯¹äºbest_prior_idx[j] = i.  
        # é‚£ä¹ˆ, æ­¤æ—¶, æˆ‘ä»¬å°±åº”è¯¥å°†best_truth_idx[i]= k ä¿®æ”¹æˆ best_truth_idx[i]= j.  
        # å³ä»¤ priorbox[i] ä¸ gtbox[j]å¯¹åº”.  
        # è¿™æ ·åšçš„åŸå› : é˜²æ­¢æŸä¸ªgtboxæ²¡æœ‰åŒ¹é…çš„ prior box.  
    matches = truths[best_truth_idx]          # Shape: [num_priors,4]  
    # truths çš„shape ä¸º[num_objs, 4], è€Œbest_truth_idxæ˜¯ä¸€ä¸ªæŒ‡ç¤ºä¸‹æ ‡çš„åˆ—è¡¨, åˆ—è¡¨é•¿åº¦ä¸º 8732,  
    # åˆ—è¡¨ä¸­çš„ä¸‹æ ‡èŒƒå›´ä¸º0~num_objs-1, ä»£è¡¨çš„æ˜¯ä¸æ¯ä¸ªpriorboxåŒ¹é…çš„gtboxçš„ä¸‹æ ‡  
    # ä¸Šé¢çš„è¡¨è¾¾å¼ä¼šè¿”å›ä¸€ä¸ªshapeä¸º [num_priors, 4], å³ [8732, 4] çš„tensor, ä»£è¡¨çš„å°±æ˜¯ä¸æ¯ä¸ªpriorboxåŒ¹é…çš„gtboxçš„åæ ‡å€¼.  
    conf = labels[best_truth_idx] + 1        # ä¸ä¸Šé¢çš„è¯­å¥é“ç†å·®ä¸å¤š, è¿™é‡Œå¾—åˆ°çš„æ˜¯æ¯ä¸ªprior boxåŒ¹é…çš„ç±»åˆ«ç¼–å·, shape ä¸º[8732]  
    conf[best_truth_overlap &lt; threshold] = 0 # å°†ä¸gtboxçš„äº¤å¹¶æ¯”å°äºé˜ˆå€¼çš„ç½®ä¸º0 , å³è®¤ä¸ºæ˜¯éç‰©ä½“æ¡†  
    loc = encode(matches, priors, variances) # è¿”å›ç¼–ç åçš„ä¸­å¿ƒåæ ‡å’Œå®½é«˜.  
    loc_t[idx] = loc    # [num_priors,4] encoded offsets to learn # è®¾ç½®ç¬¬idxå¼ å›¾ç‰‡çš„gtç¼–ç åæ ‡ä¿¡æ¯  
    conf_t[idx] = conf  # [num_priors] top class label for each prior  è®¾ç½®ç¬¬idxå¼ å›¾ç‰‡çš„ç¼–å·ä¿¡æ¯.(å¤§äº0å³ä¸ºç‰©ä½“ç¼–å·, è®¤ä¸ºæœ‰ç‰©ä½“, å°äº0è®¤ä¸ºæ˜¯èƒŒæ™¯)  
  
</code></pre>
<p>â€”|â€”  </p>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/happyday_d/article/details/86021993">https://blog.csdn.net/happyday_d/article/details/86021993</a><br><a target="_blank" rel="noopener" href="https://hellozhaozheng.github.io/z_post/PyTorch-SSD">https://hellozhaozheng.github.io/z_post/PyTorch-SSD</a></p>
</article>
<div class="article-footer slide-up">


    <section id="share">
      <div class="header"><span>Share</span></div>
      <div class="body">
        <div class="link"><input class="copy-area" readonly="true" id="copy-link" value="https://caiusy.github.io/2019/08/24/ssd/" /></div>
        <div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot;)"><img  src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/b32ef3da1162a.svg" /></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;Copied!&quot;)"><img  src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/8411ed322ced6.svg" /></a></div>
        
        <div class="qrcode" id="qrcode-wechat" style="opacity:0;height:0">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=https://caiusy.github.io/2019/08/24/ssd/"/>
        </div>
        
      </div>
    </section>
    </div>

<div class="related-wrap slide-up" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">Newer</div><a href="/2019/08/24/pythonplot/">Matplotlibç»˜åˆ¶å…­ç§å¯è§†åŒ–å›¾è¡¨</a></div><div class="item" id="next"><div class="note">Older</div><a href="/2019/08/20/20190820-squeezenet/">SqueezeNet</a></div></section></div>




  <div class="related-wrap md-text slide-up" id="comments">
    <section class='header cmt-title cap theme'>
      <p>ğŸ’¬ æ¬¢è¿ç•™è¨€è®¨è®º</p>

    </section>
    <section class='body cmt-body giscus'>
      

<svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="giscus" src="https://giscus.app/client.js" data-repo="caiusy/caiusy.github.io" data-repo-id="R_kgDOI0diCA" data-category="Announcements" data-category-id="DIC_kwDOI0diCM4C1G8d" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous"></div>

    </section>
  </div>



<footer class="page-footer slide-up footnote"><hr><div class="sitemap" style="column-count:3;"><div class="sitemap-group"><span class="fs15">åšå®¢</span><a href="/">è¿‘æœŸå‘å¸ƒ</a><a href="/categories/">åˆ†ç±»</a><a href="/tags/">æ ‡ç­¾</a><a href="/archives/">å½’æ¡£</a></div><div class="sitemap-group"><span class="fs15">æŠ€æœ¯é¢†åŸŸ</span><a href="/tags/CV/">è®¡ç®—æœºè§†è§‰</a><a href="/tags/tracking/">ç›®æ ‡è·Ÿè¸ª</a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a></div><div class="sitemap-group"><span class="fs15">å…³äº</span><a href="/about/">å…³äºæˆ‘</a><a target="_blank" rel="noopener" href="https://github.com/caiusy">GitHub</a></div></div><div class="text"><p>æœ¬ç«™ç”± <strong>Caius Lu</strong> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> ä¸»é¢˜åˆ›å»º<br>Â© 2023-2026 Â· æ¢ç´¢ AI ä¸è®¡ç®—æœºè§†è§‰çš„æ— é™å¯èƒ½ ğŸš€</p>
<p><span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡</span> | <span id="busuanzi_container_site_uv">è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº</span></p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper slide-up toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">On This Page</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSD%E7%9A%84-%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="toc-text">SSDçš„ ç½‘ç»œç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%B4%9E%E5%8D%B7%E7%A7%AF-Dilation-Conv"><span class="toc-text">ç©ºæ´å·ç§¯(Dilation Conv)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prior-Box"><span class="toc-text">Prior Box</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E7%AD%96%E7%95%A5"><span class="toc-text">è®­ç»ƒç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E8%B4%9F%E6%A0%B7%E6%9C%AC"><span class="toc-text">æ­£è´Ÿæ ·æœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0"><span class="toc-text">ç›®æ ‡å‡½æ•°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-text">ä»£ç è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-text">åŸºç¡€æ¨¡å‹å®šä¹‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8BHead%E9%83%A8%E5%88%86%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-text">æ¨¡å‹Headéƒ¨åˆ†çš„ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%85%88%E9%AA%8C%E6%A1%86%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-text">æ¨¡å‹å…ˆéªŒæ¡†çš„ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MultiBox-%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0"><span class="toc-text">MultiBox æŸå¤±å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#match%E5%87%BD%E6%95%B0%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="toc-text">matchå‡½æ•°çš„è§£æ</span></a></li></ol></li></ol></div><div class="widget-footer"><a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/><path d="M7 3.338A9.95 9.95 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12c0-1.821.487-3.53 1.338-5"/></g></svg><span>Scroll to Top</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M8 10.5h8M8 14h5.5M17 3.338A9.95 9.95 0 0 0 12 2C6.477 2 2 6.477 2 12c0 1.6.376 3.112 1.043 4.453c.178.356.237.763.134 1.148l-.595 2.226a1.3 1.3 0 0 0 1.591 1.592l2.226-.596a1.63 1.63 0 0 1 1.149.133A9.96 9.96 0 0 0 12 22c5.523 0 10-4.477 10-10c0-1.821-.487-3.53-1.338-5"/></svg><span>Join Discussion</span></a></div></widget>
</div></aside><div class='float-panel'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">


<script type="text/javascript">
  window.canonical = {"closeEnable":true,"closeText":"å…³é—­æç¤º","originalHost":null,"officialHosts":["localhost"],"encoded":""};
  window.canonical["param"] = {"permalink":"https://caiusy.github.io/2019/08/24/ssd/","checklink":"/js/plugins/video.js"};
  const ctx = {
    date_suffix: {
      just: `Just`,
      min: `minutes ago`,
      hour: `hours ago`,
      day: `days ago`,
    },
    root : `/`,
    tag_plugins: {
      chat: Object.assign({"api":"https://siteinfo.listentothewind.cn/api/v1"}),
    }
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
    loading: `https://api.iconify.design/eos-icons:three-dots-loading.svg?color=%231cd0fd`,
  };
  const deps = {
    jquery: `https://gcore.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js`,
    marked: `https://gcore.jsdelivr.net/npm/marked@13.0/lib/marked.umd.min.js`,
    lazyload: `/%5Bobject%20Object%5D`
  }
  

</script>

<script type="text/javascript">
  
  function RunItem() {
    this.list = []; // å­˜æ”¾å›è°ƒå‡½æ•°
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          utils.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // æ„é€ ä¸€ä¸ªå¯ä»¥runçš„å¯¹è±¡
    function Item(fn, name) {
      // å‡½æ•°åç§°
      this.name = name || fn.name;
      // runæ–¹æ³•
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }

  const utils = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')) {
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function () {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },

    onLoading: (el) => {
      if (el) {
        if ($(el).find('.loading-wrap').length == 0){
          $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
        }
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      const maxRetry = 3;
      let retryCount = 0;

      return new Promise((resolve, reject) => {
        const load = () => {
          utils.onLoading?.(el);

          let timedOut = false;
          const timeout = setTimeout(() => {
            timedOut = true;
            console.warn('[request] è¶…æ—¶:', url);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject('è¯·æ±‚è¶…æ—¶');
            } else {
              setTimeout(load, 1000);
            }
          }, 5000);

          fetch(url).then(resp => {
            if (timedOut) return;
            clearTimeout(timeout);

            if (!resp.ok) throw new Error('å“åº”å¤±è´¥');
            return resp;
          }).then(data => {
            if (timedOut) return;
            utils.onLoadSuccess?.(el);
            callback(data);
            resolve(data);
          }).catch(err => {
            clearTimeout(timeout);
            console.warn('[request] é”™è¯¯:', err);

            if (++retryCount >= maxRetry) {
              utils.onLoadFailure?.(el);
              onFailure?.();
              reject(err);
            } else {
              setTimeout(load, 1000);
            }
          });
        };

        load();
      });
    },
    requestWithoutLoading: (url, options = {}, maxRetry = 2, timeout = 5000) => {
      return new Promise((resolve, reject) => {
        let retryCount = 0;

        const tryRequest = () => {
          let timedOut = false;
          const timer = setTimeout(() => {
            timedOut = true;
            if (++retryCount > maxRetry) reject('timeout');
            else tryRequest();
          }, timeout);

          fetch(url, options)
            .then(resp => {
              clearTimeout(timer);
              if (!resp.ok) throw new Error('bad response');
              resolve(resp);
            })
            .catch(err => {
              clearTimeout(timer);
              if (++retryCount > maxRetry) reject(err);
              else setTimeout(tryRequest, 500);
            });
        };

        tryRequest();
      });
    },
    /********************** requestAnimationFrame ********************************/
    // 1ã€requestAnimationFrame ä¼šæŠŠæ¯ä¸€å¸§ä¸­çš„æ‰€æœ‰ DOM æ“ä½œé›†ä¸­èµ·æ¥ï¼Œåœ¨ä¸€æ¬¡é‡ç»˜æˆ–å›æµä¸­å°±å®Œæˆï¼Œå¹¶ä¸”é‡ç»˜æˆ–å›æµçš„æ—¶é—´é—´éš”ç´§ç´§è·Ÿéšæµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªé¢‘ç‡ä¸ºæ¯ç§’60å¸§ã€‚
    // 2ã€åœ¨éšè—æˆ–ä¸å¯è§çš„å…ƒç´ ä¸­ï¼ŒrequestAnimationFrame å°†ä¸ä¼šè¿›è¡Œé‡ç»˜æˆ–å›æµï¼Œè¿™å½“ç„¶å°±æ„å‘³ç€æ›´å°‘çš„çš„ cpuï¼Œgpu å’Œå†…å­˜ä½¿ç”¨é‡ã€‚
    requestAnimationFrame: (fn) => {
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
      }
      window.requestAnimationFrame(fn)
    },
    dark: {},
  };

  // utils.dark.mode å½“å‰æ¨¡å¼ dark or light
  // utils.dark.toggle() æš—é»‘æ¨¡å¼è§¦å‘å™¨
  // utils.dark.push(callBack[,"callBackName"]) ä¼ å…¥è§¦å‘å™¨å›è°ƒå‡½æ•°
  utils.dark.method = {
    toggle: new RunItem(),
  };
  utils.dark = Object.assign(utils.dark, {
    push: utils.dark.method.toggle.push,
  });
</script>
<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>

<script async src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@19.1/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
    callback_loaded: (el) => {
      el.classList.add('loaded');
      const wrapper = el.closest('.lazy-box');
      const icon = wrapper?.querySelector('.lazy-icon');
      if (icon) icon.remove();
    }
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });

  window.wrapLazyloadImages = (container) => {
    if (typeof container === 'string') {
      container = document.querySelector(container);
    }
    if (!container) return;
    
    const images = container.querySelectorAll('img');
    images.forEach((img) => {
      if (img.classList.contains('lazy')) return;

      const src = img.getAttribute('src');
      if (!src) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'lazy-box';

      const newImg = img.cloneNode();
      newImg.removeAttribute('src');
      newImg.setAttribute('data-src', src);
      newImg.classList.add('lazy');

      const icon = document.createElement('div');
      icon.className = 'lazy-icon';
      if (def.loading) {
        icon.style.backgroundImage = `url("${def.loading}")`;
      }

      wrapper.appendChild(newImg);
      wrapper.appendChild(icon);

      img.replaceWith(wrapper);
    });

    // é€šçŸ¥ LazyLoad æ›´æ–°
    if (window.lazyLoadInstance?.update) {
      window.lazyLoadInstance.update();
    }
  }
  
</script>

<!-- required -->
<script src="/js/main.js?v=1.33.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    // applyThemeToGiscus(theme)
  }

  // FIXME: è¿™ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ preferred_color_scheme ä»¥å¤–çš„ä¸»é¢˜
  const applyThemeToGiscus = (theme) => {
    // theme = theme === 'auto' ? 'preferred_color_scheme' : theme
    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)
    utils.dark.mode = newTheme === 'auto' ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light") : newTheme;
    utils.dark.method.toggle.start();

    const messages = {
      light: `Switched to Light Mode`,
      dark: `Switched to Dark Mode`,
      auto: `Switched to Auto Mode`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    } else {
      utils.dark.mode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    utils.dark.method.toggle.start();
  })()
</script>


<!-- optional -->

  <script type="module">
  const el = document.querySelector('#comments #giscus');
  util.viewportLazyload(el, load_discus, true);

  function load_discus() {
    if (!el) return;
    try {
        el.innerHTML = '';
      } catch (error) {
        console.error(error);
      }
      const script = document.createElement('script');
      script.async = true;
      for (const key of Object.keys(el.attributes)) {
        const attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
  }
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"rating":{"js":"/js/services/rating.js","api":"https://star-vote.xaox.cc/api/rating"},"vote":{"js":"/js/services/vote.js","api":"https://star-vote.xaox.cc/api/vote"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"friends_and_posts":{"js":"/js/services/friends_and_posts.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"},"voice":{"js":"/js/plugins/voice.js"},"video":{"js":"/js/plugins/video.js"},"download-file":{"js":"/js/plugins/download-file.js"},"twikoo":{"js":"/js/services/twikoo_latest_comment.js"},"waline":{"js":"/js/services/waline_latest_comment.js"},"artalk":{"js":"/js/services/artalk_latest_comment.js"},"giscus":{"js":"/js/services/giscus_latest_comment.js"},"contributors":{"edit_this_page":{"_posts/":null,"wiki/stellar/":"https://github.com/xaoxuu/hexo-theme-stellar-docs/blob/main/"},"js":"/js/services/contributors.js"},"rss":{"js":"/js/services/rss.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else if (id == 'voice') {
        ctx.voiceAudios = document.querySelectorAll('.voice>audio');
        if (ctx.voiceAudios?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            createVoiceDom(ctx.voiceAudios);
          });
        }
      } else if (id == 'video') {
        ctx.videos = document.querySelectorAll('.video>video');
        if (ctx.videos?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            videoEvents(ctx.videos);
          });
        }
      } else if (id == 'download-file') {
        ctx.files = document.querySelectorAll('.chat-file');
        if (ctx.files?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            downloadFileEvent(ctx.files);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }

    // chat iphone time
    let phoneTimes = document.querySelectorAll('.chat .status-bar .time');

    if (phoneTimes.length > 0) {
      NowTime();
      var date = new Date();
      var sec = date.getSeconds();
      var firstAdjustInterval = setInterval(firstAdjustTime, 1000 * (60 - sec));
    }

    function firstAdjustTime() {
      NowTime();
      clearInterval(firstAdjustInterval);
      setInterval(NowTime, 1000 * 60);
    }

    function NowTime() {
      for (let i = 0; i < phoneTimes.length; ++i) {
        var timeSpan = phoneTimes[i];
        var date = new Date();
        var hour = date.getHours();
        var min = date.getMinutes();
        timeSpan.innerHTML = check(hour) + ":" + check(min);
      }
    };

    function check(val) {
      if (val < 10) {
        return ("0" + val);
      }
      return (val);
    }

    // chat quote
    const chat_quote_obverser = new IntersectionObserver((entries, observer) => {
      entries.filter((entry) => { return entry.isIntersecting }).sort((a, b) => a.intersectionRect.y !== b.intersectionRect.y ? a.intersectionRect.y - b.intersectionRect.y : a.intersectionRect.x - b.intersectionRect.x).forEach((entry, index) => {
          observer.unobserve(entry.target);
          setTimeout(() => {
            entry.target.classList.add('quote-blink');
            setTimeout(() => {
              entry.target.classList.remove('quote-blink');
            }, 1000);
          }, Math.max(100, 16) * (index + 1));
        });
    });

    var chatQuotes = document.querySelectorAll(".chat .talk .quote");
    chatQuotes.forEach((quote) => {
      quote.addEventListener('click', function () {
        var chatCellDom = document.getElementById("quote-" + quote.getAttribute("quotedCellTag"));
        if (chatCellDom) {
          var chatDiv = chatCellDom.parentElement;
          var mid = chatDiv.clientHeight / 2;
          var offsetTop = chatCellDom.offsetTop;
          if (offsetTop > mid - chatCellDom.clientHeight / 2) {
            chatDiv.scrollTo({
              top: chatCellDom.offsetTop - mid + chatCellDom.clientHeight / 2,
              behavior: "smooth"
            });
          } else {
            chatDiv.scrollTo({
              top: 0,
              behavior: "smooth"
            });
          }
          chat_quote_obverser.observe(chatCellDom);
        }
      });
    });
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://gcore.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script>
  ctx.fancybox = {
    selector: `.md-text img:not([class]), .md-text .image img, .timenode p>img`,
    css: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://gcore.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error), .with-fancybox .atk-content img:not([atk-emoticon])';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const memos = document.getElementsByClassName('ds-memos');
    if (memos != undefined && memos.length > 0) {
      needFancybox = true;
    }
    const fancybox = document.getElementsByClassName('with-fancybox');
    if (fancybox != undefined && fancybox.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script defer src="https://gcore.jsdelivr.net/npm/scrollreveal@4.0/dist/scrollreveal.min.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const slideUp = {
      distance: `16px`,
      duration: `600`,
      interval: `100`,
      scale: `1`,
      opacity: 0,
      easing: "ease-out"
    };
    ScrollReveal().reveal('.slide-up', { ...slideUp });
  });
</script>

<script>
  window.MathJax = {
    tex: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"],
      ],
      processEscapes: true,
      skipTags: ["script", "noscript", "style", "textarea", "pre", "code"],
    },
    startup: {
      ready() {
        MathJax.startup.defaultReady();
        MathJax.typesetPromise().then(() => {
          const math = document.querySelectorAll("mjx-container");
          math.forEach((element) => {
            if (element.parentNode) {
              element.parentNode.classList.add("has-jax");
            }
          });
        });
      },
    },
  };
</script>

<script id="MathJax-script" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js" async></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `å¤åˆ¶æˆåŠŸ`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
