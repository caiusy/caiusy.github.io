---
title: 四边形按照顺时针排序
date: 2019-09-12 00:00:00
tags:
  - python
---

做图像检测的时候处理数据经常遇到给出矩形的四个坐标点，要求找出左上角坐标并对乱序的坐标按顺时针或者逆时针进行排序  

    
    
    1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    10  
    11  
    12  
    13  
    14  
    15  
    16  
    17  
    18  
    19  
    20  
    21  
    22  
    23  
    24  
    25  
    26  
    27  
    28  
    29  
    30  
    31  
    32  
    33  
    34  
    35  
    36  
    37  
    38  
    39  
    40  
    41  
    42  
    43  
    44  
    45  
    46  
    47  
    48  
    49  
    50  
    51  
    52  
    53  
    54  
    55  
    56  
    57  
    58  
    59  
    60  
    61  
    62  
    63  
    64  
    65  
    66  
    67  
    68  
    69  
    70  
    71  
    72  
    73  
    74  
    75  
    76  
    77  
    78  
    79  
    80  
    81  
    82  
    83  
    84  
    85  
    86  
    87  
    88  
    89  
    90  
    91  
    

| 
    
    
    from scipy.spatial import distance as dist  
    import numpy as np  
    import math  
      
      
    def cos_dist(a, b):  
        if len(a) != len(b):  
            return None  
        part_up = 0.0  
        a_sq = 0.0  
        b_sq = 0.0  
        print(a, b)  
        print(zip(a, b))   
        for a1, b1 in zip(a, b):  
            part_up += a1*b1  
            a_sq += a1**2  
            b_sq += b1**2  
        part_down = math.sqrt(a_sq*b_sq)  
        if part_down == 0.0:  
            return None  
        else:  
            return part_up / part_down  
      
      
    # this function is confined to rectangle  
    def order_points(pts):  
        # sort the points based on their x-coordinates  
        xSorted = pts[np.argsort(pts[:, 0]), :]  
      
        # grab the left-most and right-most points from the sorted  
        # x-roodinate points  
        leftMost = xSorted[:2, :]  
        rightMost = xSorted[2:, :]  
      
        # now, sort the left-most coordinates according to their  
        # y-coordinates so we can grab the top-left and bottom-left  
        # points, respectively  
        leftMost = leftMost[np.argsort(leftMost[:, 1]), :]  
        (tl, bl) = leftMost  
      
        # now that we have the top-left coordinate, use it as an  
        # anchor to calculate the Euclidean distance between the  
        # top-left and right-most points; by the Pythagorean  
        # theorem, the point with the largest distance will be  
        # our bottom-right point  
        D = dist.cdist(tl[np.newaxis], rightMost, "euclidean")[0]  
        (br, tr) = rightMost[np.argsort(D)[::-1], :]  
      
        # return the coordinates in top-left, top-right,  
        # bottom-right, and bottom-left order  
        return np.array([tl, tr, br, bl], dtype="float32")  
      
      
    def order_points_quadrangle(pts):  
        # sort the points based on their x-coordinates  
        xSorted = pts[np.argsort(pts[:, 0]), :]  
      
        # grab the left-most and right-most points from the sorted  
        # x-roodinate points  
        leftMost = xSorted[:2, :]  
        rightMost = xSorted[2:, :]  
      
        # now, sort the left-most coordinates according to their  
        # y-coordinates so we can grab the top-left and bottom-left  
        # points, respectively  
        leftMost = leftMost[np.argsort(leftMost[:, 1]), :]  
        (tl, bl) = leftMost  
      
        # now that we have the top-left and bottom-left coordinate, use it as an  
        # base vector to calculate the angles between the other two vectors  
      
        vector_0 = np.array(bl-tl)  
        vector_1 = np.array(rightMost[0]-tl)  
        vector_2 = np.array(rightMost[1]-tl)  
      
        angle = [np.arccos(cos_dist(vector_0, vector_1)), np.arccos(cos_dist(vector_0, vector_2))]  
        (br, tr) = rightMost[np.argsort(angle), :]  
      
        # return the coordinates in top-left, top-right,  
        # bottom-right, and bottom-left order  
        return np.array([tl, tr, br, bl], dtype="float32")  
    testdata =[1074,439,1078,424,991,427,991,411]  
    points = numpy.array(array).reshape(4,2)  
    poit = order_points_quadrangle(points)  
      
    poit  
      
    array([[ 991.,  411.],  
           [1078.,  424.],  
           [1074.,  439.],  
           [ 991.,  427.]], dtype=float32)  
      
  
---|---  
  
参考链接：  
<http://www.bnee.net/article/821708.html>
