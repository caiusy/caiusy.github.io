---
title: 图像处理-1
categories: 计算机视觉
date: 2019-10-13 00:00:00
tags: 计算机视觉
  - python
  - opencv
---

## 灰度图
    
    

```python
    import cv2 #opencv读取的格式是BGR
    import numpy as np
    import matplotlib.pyplot as plt#Matplotlib是RGB
    %matplotlib inline
    img=cv2.imread('cat.jpg')
    img_gray = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)
    img_gray.shape
    cv2.imshow("img_gray", img_gray)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

  
## HSV

  * H - 色调（主波长）。
  * S - 饱和度（纯度/颜色的阴影）。
  * V值（强度）
        
        1  
        2  
        3  
        4  
        5  
        

| 
        
        hsv=cv2.cvtColor(img,cv2.COLOR_BGR2HSV)  
          
        cv2.imshow("hsv", hsv)  
        cv2.waitKey(0)      
        cv2.destroyAllWindows()  
          
  
---|---  

## 图像阈值

ret, dst = cv2.threshold(src, thresh, maxval, type)

  * src： 输入图，只能输入单通道图像，通常来说为灰度图
  * dst： 输出图
  * thresh： 阈值
  * maxval： 当像素值超过了阈值（或者小于阈值，根据type来决定），所赋予的值
  * type：二值化操作的类型，包含以下5种类型： cv2.THRESH_BINARY；
  * cv2.THRESH_BINARY_INV； cv2.THRESH_TRUNC； cv2.THRESH_TOZERO；
  * cv2.THRESH_TOZERO_INV

  * cv2.THRESH_BINARY 超过阈值部分取maxval（最大值），否则取0

  * cv2.THRESH_BINARY_INV THRESH_BINARY的反转

  * cv2.THRESH_TRUNC 大于阈值部分设为阈值，否则不变
  * cv2.THRESH_TOZERO 大于阈值部分不改变，否则设为0
  * cv2.THRESH_TOZERO_INV THRESH_TOZERO的反转
        
        

| 
        
        ret, thresh1 = cv2.threshold(img_gray, 127, 255, cv2.THRESH_BINARY)  
        ret, thresh2 = cv2.threshold(img_gray, 127, 255, cv2.THRESH_BINARY_INV)  # INV 反转  
        ret, thresh3 = cv2.threshold(img_gray, 127, 255, cv2.THRESH_TRUNC)  
        ret, thresh4 = cv2.threshold(img_gray, 127, 255, cv2.THRESH_TOZERO)  
        ret, thresh5 = cv2.threshold(img_gray, 127, 255, cv2.THRESH_TOZERO_INV)  
          
        titles = ['Original Image', 'BINARY', 'BINARY_INV', 'TRUNC', 'TOZERO', 'TOZERO_INV']  
        images = [img, thresh1, thresh2, thresh3, thresh4, thresh5]  
          
        for i in range(6):  
            plt.subplot(2, 3, i + 1), plt.imshow(images[i], 'gray')  
            plt.title(titles[i])  
            plt.xticks([]), plt.yticks([])  
        plt.show()  
          
  
---|---  

## 图像平滑
    
    

```python
    img = cv2.imread('lenaNoise.png')
    cv2.imshow('img', img)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 均值滤波
    # 简单的平均卷积操作
    blur = cv2.blur(img, (3, 3))
    cv2.imshow('blur', blur)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 方框滤波
    # 基本和均值一样，可以选择归一化  ，-1表示颜色通道是一至的
    box = cv2.boxFilter(img,-1,(3,3), normalize=True)
    cv2.imshow('box', box)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 方框滤波
    # 基本和均值一样，可以选择归一化,容易越界  ，做归一化的结果跟均值滤波是一样的
    box = cv2.boxFilter(img,-1,(3,3), normalize=False)
    cv2.imshow('box', box)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 高斯滤波
    # 高斯模糊的卷积核里的数值是满足高斯分布，相当于更重视中间的
    aussian = cv2.GaussianBlur(img, (5, 5), 1)
    cv2.imshow('aussian', aussian)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 中值滤波
    # 相当于用中值代替
    median = cv2.medianBlur(img, 5)  # 中值滤波
    cv2.imshow('median', median)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 展示所有的
    res = np.hstack((blur,aussian,median))
    #print (res)
    cv2.imshow('median vs average', res)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

  
## 形态学-腐蚀操作
    
    

```python
    img = cv2.imread('dige.png')
    cv2.imshow('img', img)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    kernel = np.ones((3,3),np.uint8)
    erosion = cv2.erode(img,kernel,iterations = 1) # erode函数
    cv2.imshow('erosion', erosion)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    pie = cv2.imread('pie.png')
    cv2.imshow('pie', pie)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    kernel = np.ones((30,30),np.uint8)
    erosion_1 = cv2.erode(pie,kernel,iterations = 1)
    erosion_2 = cv2.erode(pie,kernel,iterations = 2)
    erosion_3 = cv2.erode(pie,kernel,iterations = 3)
    res = np.hstack((erosion_1,erosion_2,erosion_3))
    cv2.imshow('res', res)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

  
## 形态学-膨胀操作
    
    

```python
    img = cv2.imread('dige.png')
    cv2.imshow('img', img)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    kernel = np.ones((3,3),np.uint8)
    dige_erosion = cv2.erode(img,kernel,iterations = 1)
    cv2.imshow('erosion', erosion)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    kernel = np.ones((3,3),np.uint8)
    dige_dilate = cv2.dilate(dige_erosion,kernel,iterations = 1)
    cv2.imshow('dilate', dige_dilate)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    pie = cv2.imread('pie.png')
    kernel = np.ones((30,30),np.uint8)
    dilate_1 = cv2.dilate(pie,kernel,iterations = 1)
    dilate_2 = cv2.dilate(pie,kernel,iterations = 2)
    dilate_3 = cv2.dilate(pie,kernel,iterations = 3)
    res = np.hstack((dilate_1,dilate_2,dilate_3))
    cv2.imshow('res', res)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

  
## 开运算与闭运算
    
    

```python
    # 开：先腐蚀，再膨胀
    img = cv2.imread('dige.png')
    kernel = np.ones((5,5),np.uint8)
    opening = cv2.morphologyEx(img, cv2.MORPH_OPEN, kernel)
    cv2.imshow('opening', opening)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    # 闭：先膨胀，再腐蚀
    img = cv2.imread('dige.png')
    kernel = np.ones((5,5),np.uint8)
    closing = cv2.morphologyEx(img, cv2.MORPH_CLOSE, kernel)
    cv2.imshow('closing', closing)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

  
## 梯度运算
    
    

```python
    # 梯度=膨胀-腐蚀
    pie = cv2.imread('pie.png')
    kernel = np.ones((7,7),np.uint8)
    dilate = cv2.dilate(pie,kernel,iterations = 5)
    erosion = cv2.erode(pie,kernel,iterations = 5)
    res = np.hstack((dilate,erosion))
    cv2.imshow('res', res)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
    gradient = cv2.morphologyEx(pie, cv2.MORPH_GRADIENT, kernel)
    cv2.imshow('gradient', gradient)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

  
## 礼帽与黑帽

  * 礼帽 = 原始输入-开运算结果
  * 黑帽 = 闭运算-原始输入
        
        

| 
        
        #礼帽  
        img = cv2.imread('dige.png')  
        tophat = cv2.morphologyEx(img, cv2.MORPH_TOPHAT, kernel)  
        cv2.imshow('tophat', tophat)  
        cv2.waitKey(0)  
        cv2.destroyAllWindows()  
        #黑帽  
        img = cv2.imread('dige.png')  
        blackhat  = cv2.morphologyEx(img,cv2.MORPH_BLACKHAT, kernel)  
        cv2.imshow('blackhat ', blackhat )  
        cv2.waitKey(0)  
        cv2.destroyAllWindows()  
          
  
---|---  

参考资料： 唐宇迪 OpenCV计算机视觉实战(Python版)
