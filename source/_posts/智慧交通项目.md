---
title: 智慧交通项目
typora-copy-images-to: ./智慧交通项目
date: 2023-01-22 16:55:53
tags: 计算机视觉
---
## 智慧交通项目

### 1. 项目简介

**学习目标：**

* 了解智慧交通项目的架构
* 了解智慧交通项目中的模块
* 完成智慧交通项目的环境搭建

主要讲解计算机视觉在交通领域的相关应用， 包括车道线检测、多目标车辆追踪以及流量统计方法

* 多目标车辆追踪和计数：SORT方法、匈牙利算法。卡尔曼滤波、虚拟线圈等
* 车道线检测：张氏相机校正、仿射变换等。

![image-20220819003607691](./images/image-20220819003607691.png)

项目的架构

* 用户层
* 服务层
* ![image-20220819003735927](./images/image-20220819003735927.png)

### 2. 环境安装

工具包如下：

Numpy

Numba

Scipy

h5py

pandas

opencv-python

moviepy

Filterpy

**安装方法**

~~~sh


~~~

### 3.车流量检测实现

#### 学习目标

* 了解多目标跟跟踪的实现方法
* 知道车流量统计的方法

___

车流量统计主要有以下几种方式：

* 人工统计， 耗时耗力，且统计结果不具有可验证性
* 传感器计数， 容易收到外界环境因素干扰
* 基于视频的车流量统计， 本项目所使用的方法

主要包括以下几个步骤：

1. 使用yolov3模型进行目标检测
2. 使用sort算法进行目标跟踪， 使用卡尔曼滤波进行目标位置预测，并利用匈牙利算法对比目标的相似度， 完成车辆目标跟踪
3. 利用虚拟线圈的思想来实现车辆目标的技术，完成车流量的统计。



项目流程如下图所示：

![image-20220820222005495](./images/image-20220820222005495.png)

#### 3.0 项目介绍

#### 3.1 多目标跟踪

##### 学习目标：

* 了解多目标跟着的常见分类方法
* 了解多目标跟踪中常用的运动模型
* 知道多目标跟着的常用算法

##### 1. 多目标跟踪分类

多目标跟踪，即MOT，也就是在一段视频中同时跟踪多个目标。MOT主要应用在安防监控和自动驾驶等领域中。

![image-20220820223032905](./images/image-20220820223032905.png)

多目标跟踪可以看做多变量估计问题， 即给定一个图像序列

![image-20220820223139570](./images/image-20220820223139570.png)

1.1 初始化方法

多目标跟踪问题，并不是所有目标都会在第一帧出现，也并不是所有目标都会在出现在每一帧，。那如何对出现的目标进行初始化， 可以作为跟踪算法的分类表针， 常见的初始化方法分为两大类，一个是Detection-based-tracking（DBT），另一个是Detection-free-tracking(DFT)。

![image-20220820223509408](./images/image-20220820223509408.png)

![image-20220820223550971](./images/image-20220820223550971.png)

1.2 处理模式

MOT也存在着不同的处理模式， Online和Offline两大类， 其主要区别在于是否用了后续帧信息， 下图形象的解释了Online和offline的区别

![image-20220820223736305](./images/image-20220820223736305.png)

* Online Tracking
* Online Tracking 是对视频帧进行逐帧进行处理， 当前帧的跟踪仅仅利用过去的信息。
* Offline tracking

不同于Online Tracking， Offline Tracking会利用前后视频帧对当前帧进行目标跟踪， 这种方式只适合视频， 如果应用于摄像头，则会有滞后效应， 通常采用时间窗的方式进行处理，节省内存和加速

##### 2. 运动模型

为了简化多目标跟踪的难度， 引入运动模型类简化求解过程，运动模型捕捉目标的动态行为，它估计目标在未来帧中的潜在位置， 从而减少搜索空间。在大多数情况下， 假设目标在现实中是平缓运动的， 那么图像空间也是如此，对于车辆的运动， 大致可以分为线性和非线性两种运动：

* 线性运动： 线性运动是目标最主流的模型，假设目标的运动属性平稳（速度，加速度，位置）
* 非线性运动：虽然线性运动模型比较常用， 但由于存在它解决不了的问题，非线性模型随之产生，它可以使tracklets间运动相似度计算得更加准确。

##### 3. 跟踪方法

多目标跟踪基于神经网络的算法， 端到端的算法并不多，主要还在实验室刷榜阶段，模型复杂，速度慢， 效果不好。 主要介绍两种主流的算法：

![image-20220820233546906](./images/image-20220820233546906.png)

3.1 基于Kalman和KM算法的后端优化算法

该类算法能达到实时性， 但依赖于检测算法效果摇号，特征区分要好， （输出最终结果的好坏，依赖于较强的检测算法，而基于卡尔曼加匈牙利匹配的跟踪算法作用于能够输出检测目标的id，其次能够保证追踪算法的实时性，这样追踪效果会好，id切换少代表的算法是SORT/deepSort

![image-20220820233921267](./images/image-20220820233921267.png)

SORT是一种实用的多目标跟踪算法，引入线性速度模型于卡尔曼滤波来进行位置预测，再无合适匹配检测框的情况下，使用运动模型来预测物体的位置。匈牙利算法是一种寻找二分图的最大匹配的算法，在多目标跟踪问题中可以简单理解为寻找前后两帧的若干目标的匹配最优解的一种算法。而卡尔曼滤波可以看做是一种运动模型，用来解决对目标轨迹预测，并使用置信度比较高的跟踪结果进行预测结果的修正。



多目标跟踪一般接在目标检测后， 在工业界目标检测采用比较多的是yolo检测算法。先实现目标检测网络， 检测的输出结果主要是将检测框的位置信息输入到多目标跟踪算法中。

3.2 基于多线程的单目标跟踪的多目标跟踪算法

这类算法特点是跟踪效果很好，因为每一个类的物体都单独分配了一个跟踪器， 但该算法对尺度变换的要求大，参数调试需要合理，同时耗费cpu资源，实时性不高， 代表算法是利用KCF进行目标跟踪。



多目标跟踪本质上是多个目标同时运动的问题， 所以有提出将单目标跟踪器引入到多目标追踪的问题，为每一个目标分配一个跟踪器。然后检测地使用匹配算法来修正那些跟踪失败或者新出现的目标，代表性的单目标跟踪算法为核相关滤波算法（KCF），在精度核速度上同时达到很高的水平，是当时单目标跟踪最优秀的算法之一，后来的很多算法都是基于此做的改进。



实际应用过程会为每个目标分配一个KCF跟踪器并采用多线程的方式来组织这些跟踪器，同时因为实际硬件条件的限制，不可能提供强大的计算资源，会采用检测器与跟踪交替策略，由于检测帧率不高， 跟踪效果滞后性， 实用效果不大。

![image-20220820235435060](./images/image-20220820235435060.png)

#### 3.2 辅助功能

-----

yolo的数据格式

iou的详解



#### 3.3 卡尔曼滤波器

#### 3.4 卡尔曼滤波器实战

#### 3.5 目标估计模型-卡尔曼滤波

#### 3.6 匈牙利算法

#### 3.7 数据关联

#### 3.8 SORT/deepSORT

#### 3.9 多目标跟着实现

#### 3.10 yolo模型

#### 3.12 基于yolo的目标检测

#### 3.12 车流量统计

#### 3.13 视频中的车流量统计

